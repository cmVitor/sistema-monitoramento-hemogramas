# Arquitetura de Comunicação em Tempo Real

A arquitetura implementa um sistema híbrido de comunicação em tempo real que combina **Socket.IO** com **Redis Pub/Sub** para comunicação bidirecional instantânea e **Expo Push Notifications** como camada de garantia de entrega.

## Visão Geral

No núcleo, múltiplas instâncias do **FastAPI** conectam-se a um **Redis Cluster**, que atua simultaneamente como:

1. **Banco geoespacial** para queries de proximidade em sub-milissegundos via comandos `GEORADIUS`.
2. **Message broker** para sincronizar eventos entre servidores através de Pub/Sub.
3. **Gerenciador de estado distribuído** para sessões Socket.IO via Redis Adapter.

Isso permite **escala horizontal ilimitada**, onde cada novo servidor adiciona mais de **50.000 conexões WebSocket simultâneas** sem perda de sincronização.

## Garantia de Entrega

A garantia de entrega é assegurada por uma estratégia de **redundância dupla**:

- Quando um alerta de surto é detectado, o sistema primeiro tenta **entrega instantânea via Socket.IO** (latência < 50ms) para usuários com o app aberto.
- Simultaneamente, a mesma mensagem é enfileirada no serviço **Expo Push**, garantindo entrega mesmo com o app fechado ou conexão instável.

Esse mecanismo cria um modelo **fire-and-forget resiliente**.

## Escalabilidade

Para escalar de **10 mil para 10 milhões de usuários**, basta:

- Adicionar mais servidores FastAPI atrás de um load balancer (como **Nginx** ou **AWS ALB**).
- Expandir o Redis para modo **cluster com sharding automático**, onde cada shard processa até **100 mil operações/segundo**.
- Utilizar o **Expo Push Service**, que escala automaticamente até ~600 notificações/minuto.
- Para volumes maiores, integrar com **FCM/APNs**, que suportam bilhões de dispositivos globalmente.

## Conclusão

A arquitetura é **horizontalmente escalável**, **geograficamente distribuível** e **tolerante a falhas por design**, oferecendo um pipeline robusto para comunicação em tempo real com garantia de entrega.
