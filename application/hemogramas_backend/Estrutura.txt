O Sistema de Monitoramento de Hemogramas é uma solução backend desenvolvida em Python com FastAPI que tem como objetivo principal processar hemogramas recebidos via padrão HL7 FHIR para detectar surtos infecciosos em regiões rurais de Goiás durante a estação chuvosa. O sistema opera através de um mecanismo de subscription FHIR que recebe automaticamente recursos Observation contendo dados de hemogramas de laboratórios locais. A função receive_observation no router observations.py é responsável por aceitar essas mensagens FHIR e iniciar o processamento.

Quando um hemograma é recebido, o serviço FHIRService com sua função parse_observation faz o parsing dos dados, extraindo parâmetros hematológicos relevantes como leucócitos, hemoglobina, plaquetas e hematócrito, além de identificar a região geográfica através do código IBGE. Cada observação é então analisada individualmente pela função check_individual_alert do AnalysisService, que compara os valores contra faixas de referência pré-definidas para determinar se há anomalias individuais.

Os dados processados são armazenados em uma base consolidada local utilizando SQLAlchemy, com modelos definidos em database.py incluindo ObservationDB para armogramas individuais e CollectiveAlertDB para alertas coletivos. O sistema mantém uma estrutura de janelas deslizantes de tempo através da função calculate_window_stats que agrega dados por região geográfica em períodos configuráveis, typically 24 horas, calculando métricas como total de exames, proporção de alertas individuais, valores médios e desvio padrão.

A detecção de padrões coletivos é realizada pela função detect_collective_pattern que analisa periodicamente as estatísticas das janelas deslizantes. Esta função verifica três condições simultaneamente: volume mínimo de amostras (configurável, padrão 30 exames), proporção de alertas acima do limiar (configurável, padrão 40%) e tendência de aumento significativo (configurável, padrão 20% em relação à janela anterior). Quando detectado um padrão anômalo, o sistema gera um alerta coletivo com nível de severidade (baixo, médio, alto) baseado na magnitude da tendência.

Para notificação, o AlertService fornece a função send_push_notification que formata e envia alertas para dispositivos móveis através do Firebase Cloud Messaging, além de criar recursos FHIR Communication através da função create_fhir_communication para interoperabilidade com outros sistemas de saúde. Os gestores de saúde podem consultar os alertas através da API REST em alerts.py usando a função get_alerts com filtros por região, parâmetro ou período, e marcar alertas como investigados usando mark_alert_investigated.

O sistema inclui mecanismos de tolerância a ruído através de limites mínimos de amostragem e suavização estatística, evitando falsos positivos em regiões com pouca densidade de exames. Todas as operações são auditáveis, mantendo o vínculo entre alertas coletivos e as observations individuais que contribuíram para a detecção. A configuração do sistema é centralizada no arquivo config.py permitindo ajuste de parâmetros como tamanho da janela deslizante, limiares de detecção e endpoints FHIR.

A aplicação é iniciada através do main.py que configura o servidor FastAPI, middleware CORS, e rotas da API, além de fornecer endpoints de saúde para monitoramento da integridade do sistema. Através desta arquitetura, o sistema possibilita que gestores de saúde pública recebam alertas em tempo real baseados em evidências laboratoriais populacionais, permitindo resposta rápida a potenciais surtos infecciosos em áreas rurais durante períodos de maior risco epidemiológico.